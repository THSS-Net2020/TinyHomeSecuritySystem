(this["webpackJsonphomecam-front-end"]=this["webpackJsonphomecam-front-end"]||[]).push([[0],{205:function(e,t,a){},206:function(e,t,a){},234:function(e,t,a){},260:function(e,t,a){},346:function(e,t,a){},347:function(e,t,a){},348:function(e,t,a){},352:function(e,t,a){},353:function(e,t,a){"use strict";a.r(t);var n=a(5),s=a(0),r=a.n(s),i=a(31),c=a.n(i),o=a(86),l=a(34),u=a(79),d=a.n(u),h=a(168),m=a(116),p=a(42),j=a(41),v=a(44),b=a(43),f={appName:"Tiny Home Security System",server:"http://127.0.0.1:5000"},y=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];fetch("".concat(f.server,"/install/status")).then((function(e){return e.json()})).then((function(a){a.installed?t&&e.push("/"):window.location.href="/installer"})).catch((function(t){e.push("/error/internal")}))},O=function(e){var t=new FormData;for(var a in e)e.hasOwnProperty(a)&&t.append(a,e[a]);return t},x=function(e){var t=localStorage.getItem("uid"),a=localStorage.getItem("authKey"),n=O({uid:t,authKey:a});fetch("".concat(f.server,"/api/users/verify"),{method:"POST",body:n}).then((function(e){return e.json()})).then((function(e){200!==e.code&&(window.location.href="/login")}))},g=(a(205),function(){return Object(n.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1169",width:"200",height:"200",children:[Object(n.jsx)("path",{d:"M778.666667 938.666667h-533.333334c-23.466667 0-38.4-25.6-27.733333-46.933334L277.333333 789.333333h469.333334l57.6 102.4c12.8 21.333333-2.133333 46.933333-25.6 46.933334z",fill:"#455A64","p-id":"1170"}),Object(n.jsx)("path",{d:"M512 490.666667m-384 0a384 384 0 1 0 768 0 384 384 0 1 0-768 0Z",fill:"#78909C","p-id":"1171"}),Object(n.jsx)("path",{d:"M512 746.666667c-140.8 0-256-115.2-256-256s115.2-256 256-256 256 115.2 256 256-115.2 256-256 256z",fill:"#455A64","p-id":"1172"}),Object(n.jsx)("path",{d:"M512 490.666667m-192 0a192 192 0 1 0 384 0 192 192 0 1 0-384 0Z",fill:"#42A5F5","p-id":"1173"}),Object(n.jsx)("path",{d:"M614.4 426.666667c-25.6-29.866667-64-46.933333-102.4-46.933334s-76.8 17.066667-102.4 46.933334c-10.666667 10.666667-8.533333 27.733333 2.133333 38.4s27.733333 8.533333 38.4-2.133334c32-36.266667 91.733333-36.266667 123.733334 0 6.4 6.4 12.8 8.533333 21.333333 8.533334 6.4 0 12.8-2.133333 19.2-6.4 8.533333-8.533333 10.666667-27.733333 0-38.4z",fill:"#90CAF9","p-id":"1174"})]})}),S=a(359),k=(a(206),function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(){var e;Object(p.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).video={},e}return Object(j.a)(a,[{key:"renderScenes",value:function(){var e=this,t=this.props.cameras,a=this.props.status,s=[];return t.forEach((function(t,r){s.push(Object(n.jsxs)("div",{className:"monitor-item",children:[Object(n.jsx)("div",{className:"item-title",children:t.name}),a[t.ip]&&Object(n.jsx)("div",{className:"item-container",children:Object(n.jsx)("video",{width:360,height:270,autoPlay:"autoplay",ref:function(a){return e.video[t.name]=a},style:{width:"100%"},id:t.name,className:"player video-js vjs-default-skin",controls:!0,children:Object(n.jsx)("source",{src:"".concat(localStorage.getItem("flv_server"),"/").concat(t.name,".flv"),type:"video/x-flv"})})}),!a[t.ip]&&Object(n.jsx)("div",{className:"item-container",children:Object(n.jsx)("p",{children:"\u6444\u50cf\u5934\u79bb\u7ebf\u3002"})})]},r))})),s}},{key:"componentDidUpdate",value:function(e,t,a){var n=this,s=window.videojs;this.props.cameras.forEach((function(e){n.props.status[e.ip]&&s(e.name,{techOrder:["html5","flvjs"],flvjs:{mediaDataSource:{isLive:!0,cors:!0,withCredentials:!1}}})}))}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{className:"monitor-mode",style:{display:this.props.show?"block":"none"},children:[Object(n.jsx)(S.a,{className:"site-page-header",onBack:function(){return e.props.parent.setState({showAll:!1})},title:"\u6240\u6709\u753b\u9762",style:{background:"#fff"}}),Object(n.jsx)("div",{className:"monitor-items",children:this.renderScenes()})]})}}]),a}(s.PureComponent)),w=a(49),C=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).state={cameras:[],cameraStatus:{},showAll:!1},n}return Object(j.a)(a,[{key:"componentDidMount",value:function(){y(this.props.history),x(this.props.history),this.getCameras()}},{key:"componentWillUnmount",value:function(){this.interval&&clearInterval(this.interval)}},{key:"getCameras",value:function(){var e=this,t=localStorage.getItem("uid"),a=localStorage.getItem("authKey");fetch("".concat(f.server,"/api/camera/get"),{method:"POST",body:O({uid:t,authKey:a})}).then((function(e){return e.json()})).then((function(t){e.setState({cameras:t.payload}),e.payload=t.payload,e.getCamerasStatus(t.payload),setInterval((function(){return e.getCamerasStatus(e.payload)}),1e4)}))}},{key:"getCamerasStatus",value:function(){var e=Object(m.a)(d.a.mark((function e(t){var a,n,s,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={},n=Object(h.a)(t),e.prev=2,r=d.a.mark((function e(){var t,n,r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.value,n=localStorage.getItem("uid"),r=localStorage.getItem("authKey"),i=t.ip,e.next=4,fetch("".concat(f.server,"/api/camera/status"),{method:"post",body:O({uid:n,authKey:r,address:i})}).then((function(e){return e.json()})).then((function(e){a[i]=e.online}));case 4:case"end":return e.stop()}}),e)})),n.s();case 5:if((s=n.n()).done){e.next=9;break}return e.delegateYield(r(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),n.e(e.t1);case 14:return e.prev=14,n.f(),e.finish(14);case 17:this.setState({cameraStatus:a});case 18:case"end":return e.stop()}}),e,this,[[2,11,14,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"watchVideo",value:function(e){window.location.href="/app/video/"+e}},{key:"renderCameras",value:function(){var e=this,t=[];return this.state.cameras.forEach((function(a){t.push(Object(n.jsxs)("div",{onClick:function(){return e.state.cameraStatus[a.ip]?e.watchVideo(a.name):null},className:"index-camera-item ".concat(e.state.cameraStatus[a.ip]?"online":void 0===e.state.cameraStatus[a.ip]?"unkonwn":"offline"),children:[Object(n.jsx)("div",{className:"index-camera-icon",children:Object(n.jsx)(g,{})}),Object(n.jsxs)("div",{className:"index-camera-info",children:[Object(n.jsx)("p",{className:"index-camera-name",children:a.name}),Object(n.jsx)("p",{className:"index-camera-address",children:a.ip}),Object(n.jsx)("div",{className:"index-camera-status ".concat(e.state.cameraStatus[a.ip]?"online":void 0===e.state.cameraStatus[a.ip]?"unkonwn":"offline"),title:"".concat(e.state.cameraStatus[a.ip]?"\u6444\u50cf\u5934\u5728\u7ebf":"\u6444\u50cf\u5934\u79bb\u7ebf")})]})]},a.name))})),t}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{className:"app-index",children:[this.state.showAll&&Object(n.jsx)(k,{show:this.state.showAll,cameras:this.state.cameras,status:this.state.cameraStatus,parent:this}),Object(n.jsx)("h3",{className:"part-title",children:"\u6444\u50cf\u5934\u5217\u8868"}),Object(n.jsx)("div",{className:"index-cameras-list",children:this.renderCameras()}),Object(n.jsx)("h3",{className:"part-title",children:"\u76d1\u89c6\u6a21\u5f0f"}),Object(n.jsx)(w.a,{type:"primary",onClick:function(){return e.setState({showAll:!0})},children:"\u6253\u5f00\u76d1\u89c6\u9875\u9762\uff0c\u663e\u793a\u6240\u6709\u6444\u50cf\u5934\u753b\u9762"})]})}}]),a}(s.Component),I=a(61),N=a(358),K=a(198),L=a(179),M=a(357),A=a(361),F=a(362),D=a(193),P=a(363),q=a(360),E=(a(234),function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).subnet="",n.state={cameras:[],existedCameras:{},addCameras:{},action:"idle",showManually:!1},n}return Object(j.a)(a,[{key:"componentDidMount",value:function(){this.getCurrentCameras()}},{key:"renderCameraList",value:function(){var e=this,t=this.state,a=t.cameras,s=t.action;if("idle"===s)return Object(n.jsx)("div",{className:"list-prompt",children:"\u7b49\u5f85\u626b\u63cf..."});if("scan"===s)return Object(n.jsx)("div",{className:"list-prompt",children:"\u6b63\u5728\u626b\u63cf\uff0c\u8bf7\u7b49\u5f85..."});if(!a.length)return Object(n.jsx)("div",{className:"list-prompt",children:"\u627e\u4e0d\u5230\u6444\u50cf\u5934..."});var r=[];return this.state.cameras.forEach((function(t){e.state.existedCameras.hasOwnProperty(t)||r.push(Object(n.jsxs)("div",{className:"camera-item-card ".concat(e.state.addCameras[t]?"selected":""),children:[Object(n.jsx)("div",{className:"camera-item-icons",children:Object(n.jsx)(g,{})}),Object(n.jsxs)("div",{className:"camera-info",children:[Object(n.jsx)(P.a,{onChange:function(){var a=e.state.addCameras;e.state.addCameras[t]?delete a[t]:a[t]={selected:!0,ip:t},e.setState({addCameras:a})},className:"camera-switch"}),Object(n.jsx)("p",{className:"camera-item-address",children:t}),Object(n.jsx)("p",{className:"camera-item-type",children:"ESP32"}),Object(n.jsx)("input",{type:"text",className:"camera-item-name",placeholder:"\u4e3a\u8fd9\u4e2a\u6444\u50cf\u5934\u53d6\u4e00\u4e2a\u540d\u5b57.."})]})]},t))})),r}},{key:"getCurrentCameras",value:function(){var e=this,t=localStorage.getItem("uid"),a=localStorage.getItem("authKey"),n=O({uid:t,authKey:a});fetch("".concat(f.server,"/api/camera/get"),{method:"POST",body:n}).then((function(e){return e.json()})).then((function(t){var a={};t.payload.forEach((function(e){return a[e.id]=!0})),e.setState({existedCameras:a})}))}},{key:"requestScan",value:function(){var e=this,t=this.subnet,a=localStorage.getItem("uid"),n=localStorage.getItem("authKey"),s=O({subnet:t,uid:a,authKey:n});t.length?this.setState({action:"scan"},(function(){fetch("".concat(f.server,"/api/camera/scan"),{method:"POST",body:s}).then((function(e){return e.json()})).then((function(t){console.log(t),e.setState({action:"done",cameras:t.payload})}))})):K.b.error("\u626b\u63cf\u7684\u7f51\u6bb5\u4e0d\u80fd\u4e3a\u7a7a\uff01")}},{key:"saveResult",value:function(){var e=this,t=document.querySelectorAll(".camera-lists .camera-item-card"),a=[],n=!0;if(t.forEach((function(t){if(n){var s=t.querySelector(".camera-item-address").innerHTML,r=t.querySelector(".camera-item-name").value;if(e.state.addCameras[s])return r.length?void a.push({addr:s,name:r}):(n=!1,void K.b.error("\u6444\u50cf\u5934\u6807\u8bc6\u7b26\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a\uff01"))}})),n){var s=!0;a.forEach((function(e){var t=localStorage.getItem("uid"),a=localStorage.getItem("authKey"),n=e.name,r=e.addr,i=O({uid:t,authKey:a,name:n,ip:r});fetch("".concat(f.server,"/api/camera/add"),{method:"post",body:i}).then((function(e){return e.json()})).then((function(t){"failed"===t.status&&(s=!1,K.b.error("\u6dfb\u52a0 ".concat(e.addr," \u5931\u8d25\uff01")))}))})),s&&K.b.info("\u6b63\u5728\u4fdd\u5b58...")}}},{key:"manuallyAdd",value:function(){var e=this.ipInput.value;this.setState({cameras:[].concat(Object(D.a)(this.state.cameras),[e]),action:"done",showManually:!1})}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{className:"scan-web-camera",children:[Object(n.jsx)("h3",{className:"part-title",children:"\u6dfb\u52a0\u6444\u50cf\u5934"}),Object(n.jsx)("p",{children:"\u8bbe\u7f6e\u7f51\u6bb5"}),Object(n.jsx)(A.a,{type:"text",placeholder:"\u8bbe\u7f6e\u626b\u63cf\u6444\u50cf\u5934\u7684\u7f51\u6bb5\uff0c\u5982 192.168.1.0/24",onChange:function(t){return e.subnet=t.target.value}}),Object(n.jsx)("p",{style:{textAlign:"right",margin:"10px 0px"},children:Object(n.jsx)(w.a,{onClick:function(){return e.requestScan()},type:"primary",children:"\u626b\u63cf"})}),Object(n.jsx)("div",{className:"camera-lists",children:this.renderCameraList()}),Object(n.jsxs)("div",{className:"buttons-action",style:{textAlign:"center"},children:[Object(n.jsx)(w.a,{onClick:function(){return e.saveResult()},style:{background:"#95de64",border:0,margin:"0 20px"},type:"primary",children:"\u4fdd\u5b58"}),Object(n.jsx)(q.a,{title:"\u624b\u52a8\u6dfb\u52a0",visible:this.state.showManually,onOk:function(){return e.manuallyAdd()},onCancel:function(){return e.setState({showManually:!1})},children:Object(n.jsx)("input",{style:{width:"100%"},ref:function(t){return e.ipInput=t},placeholder:"\u624b\u52a8\u8f93\u5165 IP..."})}),Object(n.jsx)(w.a,{onClick:function(){return e.setState({showManually:!0})},children:"\u624b\u52a8\u6dfb\u52a0"})]})]})}}]),a}(s.Component)),T=(a(260),N.a.Step),U={labelCol:{span:6},wrapperCol:{span:16}},W=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).steps=[{title:"\u8bbe\u7f6e\u7ba1\u7406\u5458\u8d26\u53f7"},{title:"\u8bbe\u7f6e\u63a8\u6d41\u670d\u52a1\u5668"},{title:"\u6dfb\u52a0\u7f51\u7edc\u6444\u50cf\u5934"},{title:"\u5b8c\u6210\u5b89\u88c5"}],n.state={currentStep:0,showWait:!1,waitContent:"",cameras:[]},n}return Object(j.a)(a,[{key:"componentDidMount",value:function(){var e=this;fetch("".concat(f.server,"/install/status")).then((function(e){return e.json()})).then((function(t){t.installed&&e.props.history.push("/")}))}}]),Object(j.a)(a,[{key:"setStep",value:function(e){this.setState({currentStep:e,showWait:!1})}},{key:"guessStreamingServer",value:function(){return"rtmp://".concat(document.domain,"/live")}},{key:"guessFlvServer",value:function(){return"http://".concat(document.domain,":5002/live")}},{key:"onStreamingFinish",value:function(e){var t=this,a=e;this.setState({showWait:!0,waitContent:"\u6b63\u5728\u4fdd\u5b58\u8bbe\u7f6e..."},Object(m.a)(d.a.mark((function e(){var n,s,r,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=localStorage.getItem("uid"),s=localStorage.getItem("authKey"),r="streaming_server",i=a.server,e.next=3,fetch("".concat(f.server,"/api/option/set"),{method:"post",body:O({uid:n,authKey:s,name:r,value:i})}).then((function(e){return e.json()})).then((function(e){"failed"===e.status&&K.b.error("\u8bbe\u7f6e\u63a8\u6d41\u670d\u52a1\u5668\u5931\u8d25!")}));case 3:return r="flv_server",i=a.flvserver,e.next=7,fetch("".concat(f.server,"/api/option/set"),{method:"post",body:O({uid:n,authKey:s,name:r,value:i})}).then((function(e){return e.json()})).then((function(e){"failed"===e.status&&K.b.error("\u8bbe\u7f6e FLV \u670d\u52a1\u5668\u5931\u8d25!"),t.setStep(2)}));case 7:case"end":return e.stop()}}),e)}))))}},{key:"onAdminFinish",value:function(e){var t=this,a=e;this.setState({showWait:!0,waitContent:"\u6b63\u5728\u65b0\u5efa\u7528\u6237.."},(function(){var n=new FormData;n.append("admin_username",e.username),n.append("admin_password",e.password),fetch("".concat(f.server,"/install/install"),{method:"POST",body:n}).then((function(e){return e.json()})).then((function(e){if("success"!==e.status)return!1;fetch("".concat(f.server,"/api/user/login"),{method:"post",body:O({username:a.username,password:a.password})}).then((function(e){return e.json()})).then((function(e){localStorage.setItem("uid",e.uid),localStorage.setItem("authKey",e.authKey),t.setState({currentStep:1,showWait:!1})}))}))}))}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{className:"installer",children:[this.state.showWait&&Object(n.jsx)("div",{className:"wait-page",children:Object(n.jsx)(L.a,{tip:this.state.waitContent,indicator:Object(n.jsx)(F.a,{style:{fontSize:80,margin:"10px 0"},spin:!0})})}),Object(n.jsxs)("div",{className:"container installer-container ".concat(this.state.showWait?"blur":""),children:[Object(n.jsx)("h1",{className:"page-title",children:"\u5b89\u88c5\u5411\u5bfc"}),Object(n.jsxs)("p",{className:"page-description",children:["\u521d\u6b21\u4f7f\u7528 ",f.appName,"\uff0c \u9700\u8981\u8bbe\u7f6e\u7ba1\u7406\u5458\u8d26\u6237\u548c\u63a8\u6d41\u670d\u52a1\u5668\u3002"]}),Object(n.jsx)(N.a,{current:this.state.currentStep,children:this.steps.map((function(e){return Object(n.jsx)(T,{title:e.title},e.title)}))}),0===this.state.currentStep&&Object(n.jsx)("div",{className:"install-step",children:Object(n.jsxs)(M.a,Object(I.a)(Object(I.a)({},U),{},{name:"admin",onFinish:function(t){return e.onAdminFinish(t)},children:[Object(n.jsx)(M.a.Item,{label:"\u7ba1\u7406\u5458\u7528\u6237\u540d",name:"username",rules:[{required:!0,message:"\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u7528\u6237\u540d\u3002"}],children:Object(n.jsx)(A.a,{})}),Object(n.jsx)(M.a.Item,{label:"\u7ba1\u7406\u5458\u5bc6\u7801",name:"password",rules:[{required:!0,message:"\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u5bc6\u7801\u3002"}],children:Object(n.jsx)(A.a.Password,{})}),Object(n.jsx)("div",{style:{textAlign:"center"},children:Object(n.jsx)(w.a,{type:"primary",htmlType:"submit",children:"\u4e0b\u4e00\u6b65"})})]}))}),2===this.state.currentStep&&Object(n.jsxs)("div",{className:"install-step",children:[Object(n.jsx)(E,{}),Object(n.jsxs)("div",{style:{textAlign:"center"},children:[Object(n.jsx)(w.a,{onClick:function(){return e.setStep(0)},children:"\u4e0a\u4e00\u6b65"}),Object(n.jsx)(w.a,{type:"primary",onClick:function(){return e.setStep(3)},children:"\u5b8c\u6210"})]})]}),1===this.state.currentStep&&Object(n.jsx)("div",{className:"install-step",children:Object(n.jsxs)(M.a,Object(I.a)(Object(I.a)({},U),{},{name:"streaming",initialValues:{server:this.guessStreamingServer(),flvserver:this.guessFlvServer()},onFinish:function(t){return e.onStreamingFinish(t)},children:[Object(n.jsx)(M.a.Item,{label:"\u63a8\u6d41\u670d\u52a1\u5668",name:"server",rules:[{required:!0,message:"\u9700\u8981\u586b\u5199\u63a8\u6d41\u670d\u52a1\u5668"}],children:Object(n.jsx)(A.a,{})}),Object(n.jsx)("p",{style:{color:"#999"},children:"\u8bbe\u7f6e RTMP \u534f\u8bae\u63a8\u6d41\u670d\u52a1\u5668\uff0c\u4e00\u822c\u662f\u5f62\u5982 rtmp://<domain>/live \u7684\u5f62\u5f0f\u3002\u5982\u679c\u81ea\u52a8\u68c0\u6d4b\u7684\u503c\u4e0d\u6b63\u786e\uff0c\u8bf7\u81ea\u884c\u66f4\u6b63\u3002"}),Object(n.jsx)(M.a.Item,{label:"\u63a8\u6d41\u670d\u52a1\u5668",name:"flvserver",rules:[{required:!0,message:"\u9700\u8981\u586b\u5199\u64ad\u653e\u670d\u52a1\u5668"}],children:Object(n.jsx)(A.a,{})}),Object(n.jsx)("p",{style:{color:"#999"},children:"\u8bbe\u7f6e FLV \u64ad\u653e\u6e90\uff0c\u4e00\u822c\u662f\u5f62\u5982 http://<domain:port>/live \u7684\u5f62\u5f0f\u3002\u5982\u679c\u81ea\u52a8\u68c0\u6d4b\u7684\u503c\u4e0d\u6b63\u786e\uff0c\u8bf7\u81ea\u884c\u66f4\u6b63\u3002"}),Object(n.jsxs)("div",{style:{textAlign:"center"},children:[Object(n.jsx)(w.a,{onClick:function(){return e.setStep(1)},children:"\u4e0a\u4e00\u6b65"}),Object(n.jsx)(w.a,{type:"primary",htmlType:"submit",children:"\u4e0b\u4e00\u6b65"})]})]}))}),3===this.state.currentStep&&Object(n.jsxs)("div",{className:"install-step",children:[Object(n.jsxs)("p",{children:["\u4f60\u5df2\u7ecf\u5b8c\u6210\u4e86 ",f.appName," \u7684\u5b89\u88c5\uff01\u73b0\u5728\u53ef\u4ee5\u5f00\u59cb\u4f7f\u7528\u4e86\uff01"]}),Object(n.jsx)("p",{style:{textAlign:"center"},children:Object(n.jsx)(w.a,{onClick:function(){return e.props.history.push("/app/index")},type:"primary",children:"\u8fdb\u5165\u4e3b\u754c\u9762"})})]})]})]})}}]),a}(s.Component),R=a(356),V=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).state={cameraList:[]},n}return Object(j.a)(a,[{key:"componentDidMount",value:function(){this.updateCameraList()}},{key:"updateCameraList",value:function(){var e=this;fetch("".concat(f.server,"/api/camera/get"),{method:"post",body:O({uid:localStorage.getItem("uid"),authKey:localStorage.getItem("authKey")})}).then((function(e){return e.json()})).then((function(t){console.log(t.payload),e.setState({cameraList:t.payload})}))}},{key:"deleteCamera",value:function(e){var t=this;fetch("".concat(f.server,"/api/camera/delete"),{method:"post",body:O({uid:localStorage.getItem("uid"),authKey:localStorage.getItem("authKey"),target:e})}).then((function(e){return e.json()})).then((function(e){e.status?K.b.success("\u5220\u9664\u6444\u50cf\u5934\u6210\u529f\u3002\u4f60\u53ef\u80fd\u9700\u8981\u91cd\u542f\u670d\u52a1\u5668\u4ee5\u4f7f\u6539\u52a8\u751f\u6548\u3002"):K.b.error("\u5220\u9664\u6444\u50cf\u5934\u5931\u8d25\u3002"),t.updateCameraList()}))}},{key:"renderCameraList",value:function(){var e=this;if(0===this.state.cameraList.length)return null;var t=[{title:"ID",dataIndex:"id",key:"id"},{title:"\u6444\u50cf\u5934\u540d\u79f0",dataIndex:"name",key:"name"},{title:"\u6444\u50cf\u5934\u7f51\u7edc\u5730\u5740",dataIndex:"ip",key:"ip"},{title:"\u64cd\u4f5c",key:"action",render:function(t,a){return Object(n.jsx)(w.a,{onClick:function(){return e.deleteCamera(a.id)},type:"link",children:"\u5220\u9664\u6444\u50cf\u5934"})}}];return Object(n.jsx)(R.a,{dataSource:this.state.cameraList,columns:t})}},{key:"render",value:function(){return Object(n.jsxs)("div",{className:"cameras",children:[Object(n.jsx)("h3",{className:"part-title",children:"\u6444\u50cf\u5934\u5217\u8868"}),this.renderCameraList(),Object(n.jsx)(E,{})]})}}]),a}(s.Component),_=(a(345),a(346),a(347),function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).state={url:"",name:"",timeStr:""},n}return Object(j.a)(a,[{key:"componentDidMount",value:function(){var e=this;y(this.props.history),x(this.props.history);var t=this.props.match.params.id;t&&(this.setState({url:"".concat(localStorage.getItem("flv_server"),"/").concat(t,".flv"),name:t},(function(){(0,window.videojs)("videojs-flvjs-player",{techOrder:["html5","flvjs"],flvjs:{mediaDataSource:{isLive:!0,cors:!0,withCredentials:!1}}})})),this.interval=setInterval((function(){return e.updateTimeString()}),1e3))}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"updateTimeString",value:function(){var e="[".concat(this.state.name,"] ").concat((new Date).Format("yyyy-MM-dd HH:mm:ss"));this.setState({timeStr:e})}},{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{className:"video",children:Object(n.jsxs)("div",{className:"video-container",children:[Object(n.jsx)("video",{autoPlay:"autoplay",ref:function(t){return e.video=t},style:{width:"100%"},id:"videojs-flvjs-player",className:"player video-js vjs-default-skin",controls:!0,children:Object(n.jsx)("source",{src:this.state.url,type:"video/x-flv"})}),Object(n.jsx)("div",{className:"video-tag",children:this.state.timeStr})]})})}}]),a}(s.Component)),H=(a(348),function(e){fetch("".concat(f.server,"/api/option/get"),{method:"post",body:O({uid:localStorage.getItem("uid"),authKey:localStorage.getItem("authKey"),name:e})}).then((function(e){return e.json()})).then((function(t){"success"===t.status&&localStorage.setItem(e,t.value)}))}),z=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).state={username:"",permission:0},n}return Object(j.a)(a,[{key:"componentDidMount",value:function(){var e=this;y(this.props.history),x(this.props.history),H("flv_server"),fetch("".concat(f.server,"/api/users/info"),{method:"post",body:O({uid:localStorage.getItem("uid"),authKey:localStorage.getItem("authKey")})}).then((function(e){return e.json()})).then((function(t){localStorage.setItem("username",t.payload.name),localStorage.setItem("permission",t.payload.permission),e.setState({username:t.payload.name,permission:t.payload.permission})})).catch((function(e){return console.error(e)}))}},{key:"logOut",value:function(){confirm("\u8981\u9000\u51fa\u5f53\u524d\u7528\u6237\u5417\uff1f")&&(localStorage.removeItem("uid"),localStorage.removeItem("authKey"),localStorage.removeItem("username"),localStorage.removeItem("permission"),this.props.history.push("/login"))}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{className:"app-menu",children:[Object(n.jsx)("h1",{className:"app-name",children:f.appName}),Object(n.jsx)(w.a,{onClick:function(){return e.logOut()},type:"link",className:"current-user",children:this.state.username}),Object(n.jsxs)("div",{className:"navlinks",children:[Object(n.jsx)(o.b,{to:"/app/index",children:"\u6982\u89c8"}),Object(n.jsx)(o.b,{disabled:!0,style:{color:"#000"},to:"/app/video",children:"\u76d1\u63a7\u89c6\u9891"}),this.state.permission>=1&&Object(n.jsx)(o.b,{to:"/app/users",children:"\u7528\u6237"}),this.state.permission>=1&&Object(n.jsx)(o.b,{to:"/app/cameras",children:"\u6444\u50cf\u5934"})]})]})}}]),a}(s.Component),$=a(108),B={labelCol:{span:6},wrapperCol:{span:16}},J=$.a.Option,Y=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).state={usersList:[]},n}return Object(j.a)(a,[{key:"componentDidMount",value:function(){this.updateUsersList()}},{key:"updateUsersList",value:function(){var e=this;fetch("".concat(f.server,"/api/users/all"),{method:"post",body:O({uid:localStorage.getItem("uid"),authKey:localStorage.getItem("authKey")})}).then((function(e){return e.json()})).then((function(t){e.setState({usersList:t.payload})}))}},{key:"renderUsersList",value:function(){var e=this;if(0===this.state.usersList.length)return null;var t=[{title:"ID",dataIndex:"uid",key:"uid"},{title:"\u7528\u6237\u540d",dataIndex:"username",key:"username"},{title:"\u6743\u9650",dataIndex:"permission",key:"permission",render:function(e){return 0===e?"\u666e\u901a\u7528\u6237":1===e?"\u7ba1\u7406\u5458":2===e?"\u8d85\u7ea7\u7ba1\u7406\u5458":void 0}},{title:"\u64cd\u4f5c",key:"action",render:function(t,a){return Object(n.jsx)(w.a,{disabled:Number(a.uid)===Number(localStorage.getItem("uid")),onClick:function(){return e.deleteUser(a.uid)},type:"link",children:"\u5220\u9664\u7528\u6237"})}}];return Object(n.jsx)(R.a,{dataSource:this.state.usersList,columns:t})}},{key:"deleteUser",value:function(e){var t=this;if(confirm("\u786e\u5b9a\u8981\u5220\u9664\u8be5\u7528\u6237\u5417\uff1f")){var a=localStorage.getItem("uid"),n=localStorage.getItem("authKey");fetch("".concat(f.server,"/api/users/delete"),{method:"post",body:O({uid:a,authKey:n,target:e})}).then((function(e){return e.json()})).then((function(e){"success"===e.status?K.b.success("\u7528\u6237\u5df2\u5220\u9664\u3002"):K.b.error("\u7528\u6237\u5220\u9664\u5931\u8d25\u3002"),t.updateUsersList()}))}}},{key:"onAddUser",value:function(e){var t=this,a=e.username,n=e.password,s=e.permission,r=localStorage.getItem("uid"),i=localStorage.getItem("authKey");fetch("".concat(f.server,"/api/users/add"),{method:"post",body:O({username:a,password:n,permission:s,uid:r,authKey:i})}).then((function(e){return e.json()})).then((function(e){"success"===e.status?(K.b.success("\u6dfb\u52a0\u65b0\u7528\u6237\u6210\u529f\uff01"),t.updateUsersList()):K.b.error("\u6dfb\u52a0\u65b0\u7528\u6237\u5931\u8d25\u3002")}))}},{key:"render",value:function(){var e=this;return Object(n.jsxs)("div",{className:"users",children:[Object(n.jsx)("h3",{className:"part-title",children:"\u7528\u6237\u5217\u8868"}),this.renderUsersList(),Object(n.jsx)("h3",{className:"part-title",children:"\u6dfb\u52a0\u7528\u6237"}),Object(n.jsxs)(M.a,Object(I.a)(Object(I.a)({},B),{},{initialValues:{permission:"0"},name:"admin",onFinish:function(t){return e.onAddUser(t)},children:[Object(n.jsx)(M.a.Item,{label:"\u7528\u6237\u540d",name:"username",rules:[{required:!0,message:"\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u7528\u6237\u540d\u3002"}],children:Object(n.jsx)(A.a,{})}),Object(n.jsx)(M.a.Item,{label:"\u5bc6\u7801",name:"password",rules:[{required:!0,message:"\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u5bc6\u7801\u3002"}],children:Object(n.jsx)(A.a.Password,{})}),Object(n.jsx)(M.a.Item,{label:"\u6743\u9650",name:"permission",rules:[{required:!0,message:"\u9700\u8981\u6307\u5b9a\u7528\u6237\u6743\u9650\u3002"}],children:Object(n.jsxs)($.a,{children:[Object(n.jsx)(J,{value:"0",children:"\u666e\u901a\u7528\u6237"}),Object(n.jsx)(J,{value:"1",children:"\u7ba1\u7406\u5458"})]})}),Object(n.jsx)("div",{style:{textAlign:"center"},children:Object(n.jsx)(w.a,{type:"primary",htmlType:"submit",children:"\u65b0\u5efa\u7528\u6237"})})]}))]})}}]),a}(s.Component),Z=(a(352),{labelCol:{span:4},wrapperCol:{span:16}}),G=function(e){Object(v.a)(a,e);var t=Object(b.a)(a);function a(){return Object(p.a)(this,a),t.apply(this,arguments)}return Object(j.a)(a,[{key:"componentDidMount",value:function(){y(this.props.history)}},{key:"onLogin",value:function(e){var t=this;fetch("".concat(f.server,"/api/user/login"),{method:"post",body:O({username:e.username,password:e.password})}).then((function(e){return e.json()})).then((function(e){"success"===e.status?(K.b.success("\u767b\u5f55\u6210\u529f\uff01"),localStorage.setItem("uid",e.uid),localStorage.setItem("authKey",e.authKey),t.props.history.push("/app/index")):K.b.error("\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7528\u6237\u540d\u6216\u5bc6\u7801\u3002")}))}},{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{className:"login-page",children:Object(n.jsxs)("div",{className:"container",children:[Object(n.jsx)("h1",{className:"app-title",children:f.appName}),Object(n.jsx)("h2",{className:"action-title",children:"\u767b\u5f55\u7cfb\u7edf"}),Object(n.jsxs)(M.a,Object(I.a)(Object(I.a)({},Z),{},{initialValues:{permission:"0"},name:"admin",onFinish:function(t){return e.onLogin(t)},children:[Object(n.jsx)(M.a.Item,{label:"\u7528\u6237\u540d",name:"username",rules:[{required:!0,message:"\u9700\u8981\u8f93\u5165\u7528\u6237\u540d\u3002"}],children:Object(n.jsx)(A.a,{})}),Object(n.jsx)(M.a.Item,{label:"\u5bc6\u7801",name:"password",rules:[{required:!0,message:"\u9700\u8981\u8f93\u5165\u5bc6\u7801\u3002"}],children:Object(n.jsx)(A.a.Password,{})}),Object(n.jsx)("div",{style:{textAlign:"center"},children:Object(n.jsx)(w.a,{type:"primary",htmlType:"submit",children:"\u767b\u5f55"})})]}))]})})}}]),a}(s.Component);Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e},c.a.render(Object(n.jsx)(r.a.StrictMode,{children:Object(n.jsx)("div",{className:"homesec-app",children:Object(n.jsxs)(o.a,{children:[Object(n.jsx)(l.b,{path:"/",exact:!0,children:Object(n.jsx)(l.a,{to:"/app/index"})}),Object(n.jsx)(l.b,{path:"/app",children:Object(n.jsxs)("div",{className:"container",children:[Object(n.jsx)(l.b,{path:"/app",component:z}),Object(n.jsx)(l.b,{path:"/app/index",exact:!0,component:C}),Object(n.jsx)(l.b,{path:"/app/video/:id",exact:!0,component:_}),Object(n.jsx)(l.b,{path:"/app/cameras",exact:!0,component:V}),Object(n.jsx)(l.b,{path:"/app/users",exact:!0,component:Y})]})}),Object(n.jsx)(l.b,{path:"/login",exact:!0,component:G}),Object(n.jsx)(l.b,{path:"/installer",exact:!0,component:W})]})})}),document.getElementById("root"))}},[[353,1,2]]]);
//# sourceMappingURL=main.f6ebd6a8.chunk.js.map